<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>智能电管家-主页</title>
    <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="../static/assets/css/common.css">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/echarts/4.4.0-rc.1/echarts-en.min.js"></script>
    <style>
        [v-cloak]{
            display: none;
        }
        .el-tree-node__content{
            height: 56px;
        }
        .custom-tree-node {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            line-height: 56px;
            padding-right: 8px;
        }

        .el-header {
            background-color: #B3C0D1;
            color: #333;
            line-height: 60px;
            padding: 0px;
        }

        .el-aside {
            color: #333;
        }

        .el-tree-node__content:hover{
            background-color: #444864;
        }

        .el-tree-node:focus>.el-tree-node__content{
            background-color: black;
        }
        
        td{
            text-align: center;
        }

        .table-bordered {
            border: 1px solid #ddd;
        }
        .table {
            width: 100%;
            max-width: 100%;
            margin-bottom: 20px;
        }
        table {
            background-color: transparent;
        }
        table {
            border-spacing: 0;
            border-collapse: collapse;
        }

        caption {
            text-align: center;
            font-size: 20px;
            color: #000;
            padding-top: 8px;
            padding-bottom: 8px;
            color: #777;
        }

        table tr:first-child .blue {
            border: none;
            background: #6495ED;
        }

        .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th {
            padding: 8px;
            line-height: 1.42857143;
            vertical-align: top;
            border-top: 1px solid #ddd;
        }

        .table-bordered>tbody>tr>td, .table-bordered>tbody>tr>th, .table-bordered>tfoot>tr>td, .table-bordered>tfoot>tr>th, .table-bordered>thead>tr>td, .table-bordered>thead>tr>th {
            border: 1px solid #ddd;
        }

        table tr:last-child .blue {
            border: none;
            background: #6495ED;
        }
    </style>
</head>
<body>
<div id="root" v-cloak>
    <el-container :style="{width : windowSize.width + 'px',height : windowSize.height + 'px'}">
        <el-header style="text-align: right;">
            <el-button size="mini" class="header-button">客户端下载</el-button>
            <el-button size="mini" @click="linkToManagement">管理入口</el-button>
            <el-button size="mini">修改密码</el-button>
            <el-button size="mini">退出登录</el-button>
        </el-header>
        <el-container>
            <el-aside width="400px" style="overflow: auto;background-color: #545c64;">
                <div style="overflow: auto;" :style="{height : windowSize.height - 60 + 'px'}">
                        <el-tree
                                style="background-color: #545c64;color: white;"
                                :data="equList"
                                show-checkbox
                                node-key="id"
                                :hightlight-current="false"
                                :expand-on-click-node="false">
                              <span class="custom-tree-node" slot-scope="{ node, data }">
                                <span>{{ formatNodeStr(node) }}</span>
                                <span>
                                  <el-button
                                          type="text"
                                          size="mini">
                                      运行中
                                  </el-button>
                                  <el-button
                                          type="text"
                                          size="mini">
                                    位置
                                  </el-button>
                                </span>
                              </span>
                        </el-tree>
                </div>
            </el-aside>
            <el-container>
                <el-main :style="{height : windowSize.height - 60 + 'px'}">
                    <el-menu
                            @select="function(index){activeArea = index}"
                            :default-active="activeArea"
                            class="el-menu-demo"
                            mode="horizontal"
                            background-color="#545c64"
                            text-color="#fff"
                            active-text-color="#ffd04b">
                        <el-menu-item index="1">运行状态</el-menu-item>
                        <el-menu-item index="2">报警信息</el-menu-item>
                        <el-menu-item index="3">历史数据</el-menu-item>
                        <el-menu-item index="4">数据分析</el-menu-item>
                        <el-menu-item index="5">设备位置</el-menu-item>
                        <el-menu-item index="6">安防监控</el-menu-item>
                        <el-submenu index="7">
                            <template slot="title">业务报表</template>
                            <el-menu-item index="7-1">月报</el-menu-item>
                            <el-menu-item index="7-2">季报</el-menu-item>
                            <el-menu-item index="7-3">年报</el-menu-item>
                        </el-submenu>
                    </el-menu>
                        <!--设备编号	设备名称	设备类型	最后采集时间	负载	变压器容量	状态	报警信息	位置信息-->
                    <div v-show="activeArea == 1" class="datatable-container">
                        <el-table
                                :data="tableData"
                                border
                                stripe
                                :max-height="windowSize.height - 250 + 'px'"
                                style="width: 100%;">
                            <el-table-column type="expand">
                                <template slot-scope="props">
                                    <el-table :data="props.row.data" border size="mini">
                                        <el-table-column prop="title" label="">

                                        </el-table-column>
                                        <el-table-column prop="voltage" label="电压(V)">

                                        </el-table-column>
                                        <el-table-column prop="current" label="电流(A)">

                                        </el-table-column>
                                        <el-table-column prop="activePower" label="有功功率(KW)">

                                        </el-table-column>
                                        <el-table-column prop="reactivePower" label="无功功率(KVar)">

                                        </el-table-column>
                                        <el-table-column prop="powerFactor" label="功率因数">

                                        </el-table-column>
                                        <el-table-column prop="voltageHarmonics" label="电压谐波(V)">

                                        </el-table-column>
                                        <el-table-column prop="currentHarmonics" label="电流谐波(A)">

                                        </el-table-column>
                                        <el-table-column prop="temperH" label="温度-H(℃)">

                                        </el-table-column>
                                        <el-table-column prop="temperL" label="温度-L(℃)">

                                        </el-table-column>
                                    </el-table>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="deviceCode"
                                    label="设备编号"
                                    align="center"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    prop="deviceName"
                                    label="设备名称"
                                    align="center"
                                    width="120">
                            </el-table-column>
                            <el-table-column
                                    prop="deviceType"
                                    align="center"
                                    label="设备类型">
                            </el-table-column>
                            <el-table-column
                                    align="center"
                                    width="210"
                                    label="最后采集时间">
                                <template slot-scope="scope">
                                    <i class="el-icon-time"></i>
                                    <span style="padding-left: 10px;">{{scope.row.lastTime}}</span>
                                </template>

                            </el-table-column>
                            <el-table-column
                                    prop="loadRate"
                                    align="center"
                                    width="100"
                                    label="负载">
                                <template slot-scope="scope">
                                    {{scope.row.loadRate}}%
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="transformerCapacity"
                                    align="center"
                                    width="120"
                                    label="变压器容量">
                            </el-table-column>
                            <el-table-column
                                    prop="status"
                                    align="center"
                                    label="状态"
                                    width="120">
                                <template slot-scope="scope">
                                <span v-if="scope.row.status == 1" style="height: 50px;line-height: 30px;">
                                    <i class="el-icon-circle-check" style="font-size: 20px;color: green;"></i>运行中
                                </span>

                                        <span v-if="scope.row.status != 1" style="height: 50px;line-height: 30px;">
                                        <i  class="el-icon-circle-close" style="font-size: 20px;color: red;"></i>停运
                                    </span>
                                    </template>
                                </el-table-column>
                                <el-table-column
                                        fixed="right"
                                        align="center"
                                        width="140"
                                        label="报警信息">
                                    <template slot-scope="scope">
                                        <el-button size="mini" type="danger" @click="alert(scope.row.deviceCode)">报警信息</el-button>
                                    </template>
                                </el-table-column>
                                <el-table-column
                                        fixed="right"
                                        align="center"
                                        label="位置信息"
                                        width="100">
                                    <template slot-scope="scope">
                                        <el-button size="mini" type="success" @click="alert(scope.row.deviceCode)">查看</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <div style="text-align: right;margin-top: 5px;">
                                <el-pagination
                                        background
                                        layout="prev, pager, next,total,jumper"
                                        :total="1000">
                                </el-pagination>
                            </div>
                        </div>
                    <div v-show="activeArea == 2" class="datatable-container">
                            <div class="search-area">
                                <el-form :inline="true" :model="warningInfo.searchForm">
                                    <el-form-item label="报警日期">
                                        <el-date-picker
                                                v-model="warningInfo.searchForm.date"
                                                type="daterange"
                                                range-separator="至"
                                                start-placeholder="开始日期"
                                                end-placeholder="结束日期">
                                        </el-date-picker>
                                    </el-form-item>
                                    <el-form-item label="报警类型">
                                        <el-select v-model="warningInfo.searchForm.region">
                                            <el-option label="电流不平衡" value="shanghai"></el-option>
                                            <el-option label="过流报警" value="beijing"></el-option>
                                            <el-option label="移动侦测报警" value="xx"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <div>
                                        <el-form-item label="当前状态">
                                            <el-select v-model="warningInfo.searchForm.status">
                                                <el-option label="待处理" value="shanghai"></el-option>
                                                <el-option label="已忽略" value="beijing"></el-option>
                                                <el-option label="已处理" value="xx"></el-option>
                                            </el-select>
                                        </el-form-item>
                                        <el-form-item label="报警区域">
                                            <el-input v-model="warningInfo.searchForm.region"></el-input>
                                        </el-form-item>
                                        <el-form-item>
                                            <el-button type="primary" @click="">查询</el-button>
                                        </el-form-item>
                                    </div>
                                </el-form>
                            </div>
                            <el-table
                                    :data="warningList"
                                    border
                                    stripe
                                    :max-height="windowSize.height - 431 + 'px'"
                                    style="width: 100%;">
                                <el-table-column
                                        prop="order"
                                        label="序号"
                                        align="center"
                                        width="120">
                                </el-table-column>
                                <el-table-column
                                        prop="id"
                                        label="ID"
                                        align="center"
                                        width="180">
                                </el-table-column>
                                <el-table-column
                                        prop="companyName"
                                        align="center"
                                        label="公司名称">
                                </el-table-column>
                                <el-table-column
                                        prop="deviceName"
                                        align="center"
                                        width="230"
                                        label="设备名称">
                                </el-table-column>
                                <el-table-column
                                        prop="alarmType"
                                        align="center"
                                        width="130"
                                        label="报警类型">
                                </el-table-column>
                                <el-table-column
                                        prop="alarmPosition"
                                        align="center"
                                        width="130"
                                        label="报警位置">
                                </el-table-column>
                                <el-table-column
                                        prop="alarmValue"
                                        align="center"
                                        label="报警值"
                                        width="120">
                                    <template slot-scope="scope">
                                        <el-button v-if="scope.row.alarmType == 2" size="mini" type="warning" @click="warningInfo.warningPicDialogShow = true;warningInfo.warningPicId = scope.row.id">查看</el-button>
                                        <span v-else>{{scope.row.alarmValue}}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column
                                        prop="alarmTime"
                                        align="center"
                                        width="200"
                                        label="报警时间">
                                </el-table-column>
                                <el-table-column
                                        prop="status"
                                        align="center"
                                        label="当前状态"
                                        width="110">
                                    <template slot-scope="scope">
                                        <el-button :icon="scope.row.status == 0 ? 'el-icon-remove-outline' : 'el-icon-circle-check'" :type="scope.row.status == 0 ? 'warning' : 'success'" size="mini">{{scope.row.status == 0 ? '待处理' : '已处理'}}</el-button>
                                    </template>
                                </el-table-column>
                                <el-table-column
                                        prop="handleMethod"
                                        align="center"
                                        label="处理方式"
                                        width="100">
                                    <template slot-scope="scope">
                                        <el-button type="success" size="mini" @click="drawer = true;drawerTitle = scope.row.deviceName">查看</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <div style="text-align: right;margin-top: 5px;">
                                <el-pagination
                                        background
                                        layout="prev, pager, next,total,jumper"
                                        :total="1000">
                                </el-pagination>
                            </div>
                            <el-drawer
                                    :visible.sync="drawer"
                                    size="850px"
                                    direction="rtl">
                                <div id="printArea">
                                    <h3 align="center">维修处理单</h3>
                                    <table width="800" height="542" border="1" cellpadding="0" cellspacing="0" align="center" style="table-layout: fixed;font-size: 12px;">
                                        <caption><h4>维修单号：<input type="text" id="SN" value="" size="12" style="border:0px;border-bottom:#000000 1px solid;background:none;">
                                            生成时间：<input type="text" id="time" value="" size="12" style="border:0px;border-bottom:#000000 1px solid;background:none;"></h4></caption>
                                        <tbody>
                                        <tr>
                                            <td rowspan="3" width="15">报警信息</td>
                                            <td width="110">报警时间</td>
                                            <td width="110" id="time"></td>
                                            <td width="50">设备名称</td>
                                            <td width="100" id="equip"></td>
                                            <td width="50">所属单位</td>
                                            <td width="120"></td>
                                        </tr>
                                        <tr>
                                            <td width="20%">报警类型</td>
                                            <td id="style"></td>
                                            <td width="20%">设定阈值</td>
                                            <td id="th"></td>
                                            <td width="20%">报警值</td>
                                            <td id="data"></td>
                                        </tr>
                                        <tr>
                                            <td width="20%">设备地址*</td>
                                            <td colspan="3"></td>
                                            <td width="20%"><span style="color:#F00">维修状态<span></span></span></td>
                                            <td id="status"></td>
                                        </tr>
                                        <tr>
                                            <td rowspan="3">管理人员信息</td>
                                            <td>一级管理员（账号）</td>
                                            <td></td>
                                            <td>姓名</td>
                                            <td></td>
                                            <td>电话</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>一级管理员（账号）</td>
                                            <td></td>
                                            <td>姓名</td>
                                            <td></td>
                                            <td>电话</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>三级管理员（账号）</td>
                                            <td contenteditable="true"></td>
                                            <td >姓名</td>
                                            <td contenteditable="true"></td>
                                            <td>电话</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td rowspan="5">维修确认信息</td>
                                            <td>派单</td>
                                            <td id="confirm1"></td>

                                        <td width="20%">派单时间</td>
                                        <td></td>
                                        <td width="20%">签字</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td data-width="10px">维修班接单</td>
                                        <td id="confirm2"></td>
                                        <td width="20%">接单时间</td>
                                        <td></td>
                                        <td>签字</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>维修人员接单</td>
                                        <td></td>
                                        <td width="20%">接单时间</td>
                                        <td></td>
                                        <td>签字</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>维修完成</td>
                                        <td></td>
                                        <td width="20%">维修完成时间</td>
                                        <td></td>
                                        <td>签字</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>结单</td>
                                        <td></td>
                                        <td>结单时间</td>
                                        <td></td>
                                        <td>签字</td>
                                        <td></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </el-drawer>
                        <el-dialog title="报警抓拍" width="750px" :visible.sync="warningInfo.warningPicDialogShow">
                            <img src="https://www.baidu.com" style="width: 100%;height: 400px"/>
                        </el-dialog>
                    </div>
                    <div v-show="activeArea == 3" class="datatable-container">
                            <div class="search-area">
                                <el-form :inline="true" :model="warningInfo.searchForm">
                                    <el-form-item label="范围查询">
                                        <el-date-picker
                                                v-model="historyData.search"
                                                type="daterange"
                                                range-separator="至"
                                                start-placeholder="开始日期"
                                                end-placeholder="结束日期">
                                        </el-date-picker>
                                    </el-form-item>
                                    <el-form-item label="单日查询">
                                        <el-date-picker type="date" placeholder="选择日期" v-model="warningInfo.searchForm.startDate"></el-date-picker>
                                    </el-form-item>
                                    <div class="form-item-no-margin">
                                        <el-form-item label="显示数据">
                                            <el-checkbox-group v-model="historyData.showColumn" size="small">
                                                <el-checkbox-button label="t" key="t">温度</el-checkbox-button>
                                                <el-checkbox-button label="v" key="v">电压</el-checkbox-button>
                                                <el-checkbox-button label="c" key="c">电流</el-checkbox-button>
                                                <el-checkbox-button label="f" key="f">功率</el-checkbox-button>
                                                <el-checkbox-button label="h" key="h">谐波</el-checkbox-button>
                                            </el-checkbox-group>
                                        </el-form-item>
                                    </div>
                                </el-form>
                            </div>
                            <el-table
                                    size="small"
                                    :data="historyData.list"
                                    border
                                    stripe
                                    :height="windowSize.height - 750 + 'px'"
                                    :max-height="windowSize.height - 750 + 'px'"
                                    style="width: 100%;">
                                <el-table-column
                                        prop="order"
                                        label="序号"
                                        align="center"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        prop="time"
                                        label="时间"
                                        align="center"
                                        width="180">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('t') != -1"
                                        prop="temperHA"
                                        align="center"
                                        width="60"
                                        label="H-A相温度">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('t') != -1"
                                        prop="temperHB"
                                        align="center"
                                        width="60"
                                        label="H-B相温度">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('t') != -1"
                                        prop="temperHC"
                                        align="center"
                                        width="60"
                                        label="H-C相温度">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('t') != -1"
                                        prop="temperLA"
                                        align="center"
                                        width="60"
                                        label="L-A相温度">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('t') != -1"
                                        prop="temperLB"
                                        align="center"
                                        label="L-B相温度"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('t') != -1"
                                        prop="temperLC"
                                        align="center"
                                        width="60"
                                        label="L-C相温度">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('t') != -1"
                                        prop="temperN"
                                        align="center"
                                        label="N相温度"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('v') != -1"
                                        prop="voltageA"
                                        align="center"
                                        label="A相电压"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('v') != -1"
                                        prop="voltageB"
                                        align="center"
                                        label="B相电压"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('v') != -1"
                                        prop="voltageC"
                                        align="center"
                                        label="C相电压"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('c') != -1"
                                        prop="currentA"
                                        align="center"
                                        label="A相电流"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('c') != -1"
                                        prop="currentB"
                                        align="center"
                                        label="B相电流"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('c') != -1"
                                        prop="currentC"
                                        align="center"
                                        label="C相电流"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="activePowerA"
                                        align="center"
                                        label="A相有功功率"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="activePowerB"
                                        align="center"
                                        label="B相有功功率"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="activePowerC"
                                        align="center"
                                        label="C相有功功率"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="totalActivePower"
                                        align="center"
                                        label="总有功功率"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="reactivePowerA"
                                        align="center"
                                        label="A相无功功率"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="reactivePowerB"
                                        align="center"
                                        label="B相无功功率"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="reactivePowerC"
                                        align="center"
                                        label="C相无功功率"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="totalReactivePower"
                                        align="center"
                                        label="总无功功率"
                                        width="60">
                                </el-table-column>

                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="powerFactorA"
                                        align="center"
                                        label="A相功率因数"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="powerFactorB"
                                        align="center"
                                        label="B相功率因数"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="powerFactorC"
                                        align="center"
                                        label="C相功率因数"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('f') != -1"
                                        prop="totalPowerFactor"
                                        align="center"
                                        label="总功率因数"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('h') != -1"
                                        prop="voltageHarmonicsA"
                                        align="center"
                                        label="A相电压谐波"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('h') != -1"
                                        prop="voltageHarmonicsB"
                                        align="center"
                                        label="B相电压谐波"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('h') != -1"
                                        prop="voltageHarmonicsC"
                                        align="center"
                                        label="C相电压谐波"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('h') != -1"
                                        prop="currentHarmonicsA"
                                        align="center"
                                        label="A相电流谐波"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('h') != -1"
                                        prop="currentHarmonicsB"
                                        align="center"
                                        label="B相电流谐波"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        v-if="historyData.showColumn.indexOf('h') != -1"
                                        prop="currentHarmonicsC"
                                        align="center"
                                        label="C相电流谐波"
                                        width="60">
                                </el-table-column>
                                <el-table-column
                                        prop="totalPower"
                                        align="center"
                                        label="累计电能"
                                        width="100">
                                </el-table-column>
                            </el-table>
                            <div class="his-echarts-area">
                                <div id="echartsInstance" style="height: 400px;">

                                </div>
                            </div>
                        </div>
                    <div v-show="activeArea && activeArea.startsWith('7')" class="datatable-container">
                        <div class="search-area">
                            <el-form :inline="true" :model="warningInfo.searchForm">
                                <div class="form-item-no-margin">
                                    <el-form-item v-if="activeArea == '7-1'">
                                        <el-date-picker type="month" placeholder="选择日期" v-model="warningInfo.searchForm.startDate"></el-date-picker>
                                    </el-form-item>
                                    <el-form-item label="年份" v-if="activeArea != '7-1'">
                                        <el-date-picker type="year" placeholder="选择年份" v-model="warningInfo.searchForm.startDate"></el-date-picker>
                                    </el-form-item>
                                    <el-form-item v-if="activeArea == '7-2'">
                                        <el-radio-group v-model="dataReport.season" size="small">
                                            <el-radio-button label='1' key="1">第一季度</el-radio-button>
                                            <el-radio-button label='2' key="2">第二季度</el-radio-button>
                                            <el-radio-button label='3' key="3">第三季度</el-radio-button>
                                            <el-radio-button label='4' key="4">第四季度</el-radio-button>
                                        </el-radio-group>
                                    </el-form-item>
                                    <el-button type="success">查询</el-button>
                                </div>
                            </el-form>
                        </div>
                        <table class="table table-striped table-bordered">
                            <caption id="caption"><b style="color:black;">2019年{{activeArea == '7-1' ? '11月' : (activeArea == '7-2' ? '第1季度' : '')}}用电情况一览表</b></caption>
                            <tbody><tr style="">
                                <td colspan="7" style="text-align:left;" class="blue">单位：</td>
                                <td colspan="3" style="text-align:right" class="blue">2019年11月17日</td>
                            </tr>
                            <tr>
                                <td rowspan="6">生产用电</td>
                                <td>项目</td>
                                <td>本月表数</td>
                                <td>上月表数</td>
                                <td>倍率</td>
                                <td>电量</td>
                                <td>单价</td>
                                <td>金额</td>
                                <td>利率</td>
                                <td>备注</td>
                            </tr>
                            <tr>
                                <td>有功</td>
                                <td>0</td>
                                <td>0</td>
                                <td></td>
                                <td>0</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>无功</td>
                                <td>0</td>
                                <td>0</td>
                                <td></td>
                                <td>0</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>峰</td>
                                <td>NaN</td>
                                <td>0</td>
                                <td></td>
                                <td>0</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>谷</td>
                                <td>NaN</td>
                                <td>0</td>
                                <td></td>
                                <td>0</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>平</td>
                                <td>NaN</td>
                                <td>0</td>
                                <td></td>
                                <td>0</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td rowspan="3">注：</td>
                                <td colspan="2">过载A相( 0 )次</td>
                                <td colspan="2">缺相A相( 0 )次</td>
                                <td colspan="2">过热H-A相( 0 )次</td>
                                <td colspan="2">过热L-A相( 0 )次</td>
                                <td>过热N相( 0 )次</td>
                            </tr>
                            <tr>
                                <td colspan="2">过载B相( 0 )次</td>
                                <td colspan="2">缺相B相( 0 )次</td>
                                <td colspan="2">过热H-B相( 0 )次</td>
                                <td colspan="2">过热L-B相( 0 )次</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td colspan="2">过载C相( 0 )次</td>
                                <td colspan="2">缺相C相( 0 )次</td>
                                <td colspan="2">过热H-C相( 0 )次</td>
                                <td colspan="2">过热L-C相( 0 )次</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td colspan="5" style="text-align:left;" class="blue"></td>
                                <td class="blue">审核：</td>
                                <td class="blue"></td>
                                <td class="blue">制表：</td>
                                <td colspan="2" class="blue"></td>
                            </tr>
                            </tbody></table>
                        <div id="monthReportCharts" style="height: 295px;">
                        </div>
                    </div>
                </el-main>
            </el-container>
        </el-container>
    </el-container>
</div>
<script>
    let historyDataColumnInfo = [
        {columnProp : 'temperHA',columnGroup : 't',columnName : 'H-A温度'},
        {columnProp : 'temperHB',columnGroup : 't',columnName : "H-B温度"},
        {columnProp : 'temperHC',columnGroup : 't',columnName : "H-C温度"},
        {columnProp : 'temperLA',columnGroup : 't',columnName : "L-A温度"},
        {columnProp : 'temperLB',columnGroup : 't',columnName : "L-B温度"},
        {columnProp : 'temperLC',columnGroup : 't',columnName : "L-C温度"},
        {columnProp : 'temperN',columnGroup : 't',columnName : "N相温度"},

        {columnProp : 'currentA',columnGroup : 'c',columnName : "A相电流"},
        {columnProp : 'currentB',columnGroup : 'c',columnName : "B相电流"},
        {columnProp : 'currentC',columnGroup : 'c',columnName : "C相电流"},

        {columnProp : 'voltageA',columnGroup : 'v',columnName : "A相电压"},
        {columnProp : 'voltageB',columnGroup : 'v',columnName : "B相电压"},
        {columnProp : 'voltageC',columnGroup : 'v',columnName : "C相电压"},

        {columnProp : 'activePowerA',columnGroup : 'f',columnName : "A相有功功率"},
        {columnProp : 'activePowerB',columnGroup : 'f',columnName : "B相有功功率"},
        {columnProp : 'activePowerC',columnGroup : 'f',columnName : "C相有功功率"},
        {columnProp : 'totalActivePower',columnGroup : 'f',columnName : "总有功功率"},
        {columnProp : 'reactivePowerA',columnGroup : 'f',columnName : "A相无功功率"},
        {columnProp : 'reactivePowerB',columnGroup : 'f',columnName : "B相无功功率"},
        {columnProp : 'reactivePowerC',columnGroup : 'f',columnName : "C相无功功率"},
        {columnProp : 'totalReactivePower',columnGroup : 'f',columnName : "总无功功率"},
        {columnProp : 'powerFactorA',columnGroup : 'f',columnName : "A相功率因数"},
        {columnProp : 'powerFactorB',columnGroup : 'f',columnName : "B相功率因数"},
        {columnProp : 'powerFactorC',columnGroup : 'f',columnName : "C相功率因数"},
        {columnProp : 'totalPowerFactor',columnGroup : 'f',columnName : "总功率因数"},

        {columnProp : 'voltageHarmonicsA',columnGroup : 'h',columnName : "A相电压谐波"},
        {columnProp : 'voltageHarmonicsB',columnGroup : 'h',columnName : "B相电压谐波"},
        {columnProp : 'voltageHarmonicsC',columnGroup : 'h',columnName : "C相电压谐波"},
        {columnProp : 'currentHarmonicsA',columnGroup : 'h',columnName : "A相电流谐波"},
        {columnProp : 'currentHarmonicsB',columnGroup : 'h',columnName : "B相电流谐波"},
        {columnProp : 'currentHarmonicsC',columnGroup : 'h',columnName : "C相电流谐波"},
    ];
    let windowSize = {
        width : document.documentElement.clientWidth,
        height : document.documentElement.clientHeight
    };
    $(function () {
        $(window).resize(function(){
            let windowWidth = document.documentElement.clientWidth;
            let windowHeight = document.documentElement.clientHeight;
            windowSize.width = windowWidth;
            windowSize.height = windowHeight;
        });
    });
    let item = {
        deviceCode: '863920031467884',
        deviceName: '终端7',
        deviceType: '柱上变压器 全绝缘变台',
        lastTime : '2019-06-21 08:31:26',
        loadRate : 1632.00,
        transformerCapacity : 315,
        status : 1,
        data : [
            {title : "A相",voltage : 0,current : 0,activePower : 0,reactivePower : 0,powerFactor : 0,voltageHarmonics : 0,currentHarmonics : 0,temperH : 0,temperL : 0},
            {title : "B相",voltage : 0,current : 0,activePower : 0,reactivePower : 0,powerFactor : 0,voltageHarmonics : 0,currentHarmonics : 0,temperH : 0,temperL : 0},
            {title : "C相",voltage : 0,current : 0,activePower : 0,reactivePower : 0,powerFactor : 0,voltageHarmonics : 0,currentHarmonics : 0,temperH : 0,temperL : 0},
            {title : "N相",voltage : 0,current : 0,activePower : 0,reactivePower : 0,powerFactor : 0,voltageHarmonics : 0,currentHarmonics : 0,temperH : 0,temperL : 0}
        ]
    };
    let equList = [
        {id : 1,name : "南开大学",children : [{id : 11,name : "设备1"}]},
        {id : 2,name : "上海汽车地毯(铁岭)汽车材料有限公司",children : [{id : 12,name : "设备1"}]},
        {id : 3,name : "国网辽阳供电公司",children : [{id : 13,name : "设备1"}]},
        {id : 4,name : "国网辽阳供电公司弓长岭分公司",children : [{id :14,name : "设备1"}]},
        {id : 5,name : "国网铁岭供电公司",children : [{id : 15,name : "设备1"}]},
        {id : 6,name : "南开大学",children : [{id : 16,name : "设备1"}]},
        {id : 7,name : "铁岭市政管修处",children : [{id : 17,name : "设备1"}]},
        {id : 8,name : "辽宁紫科环保科技有限公司",children : [{id : 18,name : "设备1"}]},
    ];
    let list = [];
    for(let i = 0;i < 20;i++){
        let obj = Object.assign({},item);
        obj.deviceName += i;
        list.push(obj);
    }
    let startTime = new Date().getTime();
    let root =
    new Vue({
        el : "#root",
        data : {
            warningInfo : {//告警信息
                searchForm : {},
                warningPicId : null,
                warningPicDialogShow : false
            },
            historyData : {//历史数据
                showColumn : ['t','c','v','f','h'],
                echartsInstance : null,
                list : [],
            },
            dataReport : {//数据报表
                monthReportEcahrstIns : null
            },
            drawer : false,
            drawerTitle : null,
            windowSize : windowSize,
            activeArea : "1",
            tableData: list,
            equList : equList,
            warningList : [{
                order : 1,
                id : 1,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 2,
                alarmPosition : "报警位置",
                alarmValue : 19,
                alarmTime : "2018-10-11 12:31",
                status : 0,
                handleMethod : "处理方式"
            },{
                order : 2,
                id : 2,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 1,
                alarmPosition : "报警位置",
                alarmValue : 11,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 3,
                id : 3,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 3,
                alarmPosition : "报警位置",
                alarmValue : 20,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 4,
                id : 4,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 2,
                alarmPosition : "报警位置",
                alarmValue : 18.1,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 5,
                id : 5,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 4,
                alarmPosition : "报警位置",
                alarmValue : 10,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            },{
                order : 6,
                id : 6,
                companyName : "公司名称",
                deviceName : "设备名称",
                alarmType : 5,
                alarmPosition : "报警位置",
                alarmValue : 12.0,
                alarmTime : "2018-10-11 12:31",
                status : 1,
                handleMethod : "处理方式"
            }]
        },
        computed : {
            echartsLegend : function(){
                this.historyData.showColumn.indexOf("") != -1
            }
        },
        methods : {
            linkToManagement : function(){
                let a = document.createElement("a");
                a.href="management";
                a.target = "_blank";
                a.click();
            },
            changeArea : function(){
                console.log(1);
            },
            menuOpen : function(param1){
                console.log(param1);
            },
            menuClose : function(param1){
                console.log(param1);
            },
            formatNodeStr : function(node){
                console.log(node);
                return node.data.name;
            },
            updateEcharts : function(){
                if(!this.historyData.echartsInstance){
                    this.historyData.echartsInstance = echarts.init(document.getElementById('echartsInstance'));
                }
                let legendList = [];
                this.historyData.showColumn.forEach(group=>{
                    historyDataColumnInfo.forEach(columnInfo=>{
                        if(group == columnInfo.columnGroup){
                            legendList.push(columnInfo.columnName);
                        }
                    })
                });
                let seriesList = [];
                legendList.forEach(item=>{
                    let data = [];
                    for(let i = 1;i <= 31;i++){
                        let random = Math.random();
                        if(random > 0.9){
                            random *= -1;
                        }
                        data.push(random * 100);
                    }
                    seriesList.push({
                        name : item,
                        type : 'line',
                        data : data
                    });
                });
                let xAxis = [];
                for(let i = 1;i <= 31;i++){
                    xAxis.push("2019-11-" + i);
                }
                let options = {
                    title: {
                        //text: '折线图'
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data:legendList,
                        type : 'scroll'
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    toolbox: {
                        /*feature: {
                            saveAsImage: {}
                        }*/
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: xAxis
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: seriesList
                };
                this.historyData.echartsInstance.setOption(options,{
                    notMerge : true
                });
            }
        },
        watch : {
            "historyData.list" : function(){
                this.updateEcharts();
            },
            "historyData.showColumn" : function(){
                this.updateEcharts();
            },
            "activeArea" : function(newValue){
                switch (newValue) {
                    case '3' : {
                        let that = this;
                        Vue.nextTick(function(){
                            that.historyData.echartsInstance.resize();
                        });
                    }break;
                    case '7-1' : {
                        let option = {
                            title : {
                                text : '2019年11月用电统计',
                                //x : 'center'
                            },
                            legend: {},
                            tooltip: {},
                            dataset: {
                                source: [
                                    ['product', '当月', '上月'],
                                    ['有功', 43.3, 85.8],
                                    ['无功', 83.1, 73.4],
                                    ['峰', 86.4, 65.2],
                                    ['谷', 72.4, 53.9],
                                    ['平', 72.4, 53.9]
                                ]
                            },
                            xAxis: {type: 'category'},
                            yAxis: {},
                            // Declare several bar series, each will be mapped
                            // to a column of dataset.source by default.
                            series: [
                                {type: 'bar',label : {normal : {show : true,position : 'top'}},barWidth : '35px'},
                                {type: 'bar',label : {normal : {show : true,position : 'top'}},barWidth : '35px'}
                            ]
                        };
                        Vue.nextTick(function(){
                            let ins = echarts.init(document.getElementById('monthReportCharts'));
                            ins.setOption(option,{
                                notMerge : true
                            });
                        });
                    }break;
                }
            }
        },
        mounted : function(){
            let data = [];
            for(let i = 0;i < 10;i++){
                let obj = {};
                historyDataColumnInfo.forEach(item=>{
                    obj[item.columnProp] = Math.round(Math.random() * 220);
                });
                obj['totalPower'] = Math.random() * 1000;
                obj['order'] = i;
                obj['time'] = '2019-10-01 10:10:10';
                data.push(obj);
            }
            //this.historyData.list = data;
            Vue.nextTick(function(){
                let endTime = new Date().getTime();
                console.log("主页Vue加载时间：" + (endTime - startTime));
            });
        }
    });
</script>
</body>
</html>